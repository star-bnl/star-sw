<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>TFS USAGE</title>
  </head>

<body bgcolor="white" text="black" link="#0000f0" vlink="#f00000">

<pre>
*tfs.kumac
*
* Usage:    exec  tfs no_events=N  file=FILE
*
*----------------------------------------------------------------------
* this routine is the generic "g2t tables to tpc hits" macro
* modules involved: tfs tpg
* ----------------------------------------------------------------------

MACRO tfs  no_events=1 file=

 PAMS      = /afs/rhic/star/packages/SL98b/pams
 UTIL_HOME = /afs/rhic/star/packages/SL98b/kumacs/util
 KUM_HOME  = /afs/rhic/star/packages/SL98b/kumacs/chain
 TPC_HOME  = [PAMS]/tpc/kumac
 TPG_HOME  = [TPC_HOME]
 TFS_HOME  = [TPC_HOME]

 make tpc

 *****************************************
 * variables
 *****************************************
 alias/create STAFCV_OK  1
 alias/create STAFCV_BAD 0

 ************************************************
 * create table directories necessary for TFS
 ************************************************
 mkdir  /dui/constants/  
 mkdir  /dui/constants/tpc
 mkdir  /dui/constants/tpc/geometry/
 mkdir  /dui/constants/tpc/params/

 mkdir  /dui/geant/
 mkdir  /dui/geant/Event
 mkdir  /dui/geant/Run

 mkdir  /dui/data/ 
 mkdir  /dui/data/tpc/
 mkdir  /dui/data/tpc/hits/

 /MACRO/GLOBAL/CREATE DATA_SAMPLES  $AFS_RHIC/star/data/samples/ 
 /MACRO/GLOBAL/CREATE KUMACS_UTIL   $AFS_RHIC/star/packages/SL98b/kumacs/util/
 /MACRO/GLOBAL/CREATE KUMACS_TPC    $AFS_RHIC/star/packages/SL98b/kumacs/tpc/
 /MACRO/GLOBAL/CREATE PARAMS_TPC    $AFS_RHIC/star/packages/SL98b/params/tpc/
 /MACRO/GLOBAL/CREATE PAMS_TPC_KUMAC  _
                               $AFS_RHIC/star/packages/SL98b/pams/tpc/kumac/

 *****************************************
 * TPC geometry
 *****************************************
 exec [TPG_HOME]/tpg_init</pre>
 &nbsp;&nbsp; *** See <a  href="http://www.rhic.bnl.gov/afs/rhic/star/doc/www/packages_l/SL98b/pams/tpc/kumac/tpg_init.kumac">[TPG_HOME]/tpg_init</a> for details.<br>
<pre>
 ***************************************** 
 * open output data file 
 *****************************************
 dio/newf output /star/mds/users/[file]-tfs.dsl w

 ***************************************** 
 * open output Ntuple file 
 *****************************************
 hi/file 1 [file]-tfs.nt ! n
 newcwnt 111 /dui/data/tpc/hits/tphit


 Message 'Doing' [no_events] 'events'
 ***************************************** 
 * open input file and read header
 *****************************************
 exec [UTIL_HOME]/input_g2t_file#init  [file] </pre>
 &nbsp;&nbsp; *** See <a href="http://www.rhic.bnl.gov/afs/rhic/star/doc/www/packages_l/SL98b/kumacs/util/input_g2t_file.kumac">[UTIL_HOME]/input_g2t_file#init</a> for details.<br>
<pre>
 cd /dui/geant
 stream/getevent G2Tfile
 ls /dui/geant/Event

 *****************************************
 * event loop
 *****************************************

 do ievent=1,[no_events]
    
    if (staf_status(1).ne.STAFCV_OK) goto EOF
    message 'run_all-I3 : doing loop' [ievent]

    cd /dui/data/tpc
    exec [TFS_HOME]/tfs_run [ievent] [TFS_HOME]</pre>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *** See <a href="http://www.rhic.bnl.gov/afs/rhic/star/doc/www/packages_l/SL98b/pams/tpc/kumac/tfs_run.kumac">[TFS_HOME]/tfs_run</a> for details.<br>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *** [TFS_HOME]/tfs_run calls  <a href="http://www.rhic.bnl.gov/afs/rhic/star/doc/www/packages_l/SL98b/pams/tpc/kumac/tfs_init.kumac">[TFS_HOME]/tfs_init</a> for the first event to do a few initializations.
<pre> 
      if (staf_status(1) .ne. stafcv_ok) goto NEXT_EVENT
    endif  
 dio/stream/putevent output /dui

 cdir //LUN1
 cwn/append 111 /dui/data/tpc/hits/tphit

NEXT_EVENT:
 
 dio/stream/getevent G2Tfile /dui/geant
 
enddo

*  task is completed
EOF:

*****************************************
* close output data file
*****************************************
dio/stream/close data

*****************************************
* close Ntuple file
*****************************************
cdir //LUN1
hrout 0
close 1

RETURN
*****************************************
* End of  tfs.kumac 
*****************************************

</pre>
<a href=tfs_usage.html><strong>Back to TFS-USAGE Page</strong></a>

    <hr>
    <address><a href="mailto:dhammika@gibbs.npl.washington.edu">Dhammika Weerasundara</a></address>
<!-- Created: Tue Apr 21 12:03:26 PDT 1998 -->
<!-- hhmts start -->
Last modified: Fri Apr 24 15:14:20 PDT 1998
<!-- hhmts end -->
  </body>
</html>
