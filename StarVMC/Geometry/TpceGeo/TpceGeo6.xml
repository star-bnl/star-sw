<Document  file="StarVMC/Geometry/TpceGeo/TpceGeo6.xml"  >

    <Module name="TpceGeo6" comment="This is complete iTPC geometry (y2019), no material budget changes though "  >

        <Author name="David Underwood corrected by Maxim Potekhin, 
		      implmented in TGeo by Yuri, translated back 
		      to AgSTAR by Victor, and code cleanup by Jason,
		      converted to iTPC by Irakli"  />

        <Created date="  Dec 7, 2005 "  />

        <CDE  >
            AGECOM
            GCUNIT
            GCONST
        </CDE>
        
        <varlist type="CHARACTER*4"  >
            voluName
        </varlist> 

  	<varlist type="real"> tsas_zoffset/0.0/, tsgt_zoffset/0.0/ </varlist>

        <Content>
             TPCE,TPCM,TIFC,TIKA,TINX,TIAD,TOFC,TOFS,
             TOKA,TONX,TOAD,TOIG,TOHA,TSWH,TSAW,TSAS,
             TWAS,FEEA,FEEP,FEER,FEEI,TALS,TSGT,TWBT,
             TWRI,TWRG,TWRC,TWTR,TWMR,TRDO,TBRW,TWRB,
             TCOO,TCAB,TRDC,TRIB,TWIR,THOL,FEES,TPGV,
             TPSS,TPAD
        </Content>

        <varlist type="INTEGER"  >
            kInner,kOuter
        </varlist>
        
        <Parameter name="kInner" value="0"  />
        <Parameter name="kOuter" value="1"  />

<Export language="Mortran">
        <varlist type="REAL">INCH,CM</varlist>
        
        <Parameter name="INCH" value="2.54"  />
        <Parameter name="CM" value="1."  />
</Export>

        <varlist type="INTEGER"  >
            kBlack,kRed,kGreen,kBlue,kYellow,kViolet,kLightBlue
        </varlist>
        <varlist type="integer">
	  kBbox,kPara,kTrd1,iShape,
	</varlist>
        
        <Parameter name="kBlack" value="1"  />
        <Parameter name="kRed" value="2"  />
        <Parameter name="kGreen" value="3"  />
        <Parameter name="kBlue" value="4"  />
        <Parameter name="kYellow" value="5"  />
        <Parameter name="kViolet" value="6"  />
        <Parameter name="kLightBlue" value="7"  />

	<Parameter name="kBbox" value="0" />
	<Parameter name="kPara" value="1" />
	<Parameter name="kTrd1" value="2" />
	
	<varlist type="int"> mycount/0/ </varlist>

<Export language="Mortran">
        <varlist type="REAL"  >
            sind,cosd,tand
        </varlist>
</Export>

        <varlist type="REAL"  >
            cos15,sin15,tan15
        </varlist>
        
        <Parameter name="cos15" value=".965925826289068312"  />
        <Parameter name="sin15" value=".258819045102520739"  />
        <Parameter name="tan15" value=".267949192431122696"  />

        <varlist type="INTEGER"  >
            i,j,iSecAng,nCount/0/,jTRIB,kase
        </varlist>
        

        <varlist type="REAL"  >
            x,x0,x1,x2,dx,dx1,dx2,xc
        </varlist>
        
        <varlist type="REAL"  >
            y,y0,y1,y2,dy,dy1,dy2
        </varlist>
        
        <varlist type="REAL"  >
            z,z0,z1,z2,dz,dz1,dz2
        </varlist>
        
        <varlist type="REAL"  >
            zBeg,zDed,zPmt,zEnd
        </varlist>
        
        <varlist type="REAL"  >
            r,r0,r1,r2,dr
        </varlist>
        
        <varlist type="REAL"  >
            alpha,beta
        </varlist>
        
        <varlist type="REAL"  >
            xw,dxw,yw,dyw,zw,dzw,dYdX
        </varlist>
        
        <varlist type="REAL"  >
            dRSectorShift/0/
        </varlist>
        
        <varlist type="REAL"  >
            myDx,myDy,myDz,myAlph,myThet,myPhi,myPar(20)
        </varlist>
        

        <varlist type="REAL"  >
            tocsIR,tocsOR,tokaIR,tokaOR,tonxIR,tonxOR,toadIR,toadOR,toigIR,toigOR
        </varlist>
        
        <varlist type="REAL"  >
            toalIR,toalOR,tohaIR,tohaOR,toalIR2,toalOR2,tofcIR,tofcOR,tofsIR,tofsOR
        </varlist>
        

        <varlist type="REAL"  >
            tifcIR,tialIR,tialOR,tikaIR,tikaOR,tinxIR,tinxOR,tiadIR,tiadOR,tifcOR
        </varlist>
        

        <varlist type="REAL"  >
            tpgvLeng,tofcLeng,tpgvz
        </varlist>
        
        <varlist type="INTEGER"  >
            i_sec,i_row
        </varlist>
        
        <External routine="TPADSTEP"  />
        <External routine="TPAISTEP"  />
        <External routine="TPAOSTEP"  />
        <External routine="TPCELASER"  />

        <varlist type="REAL"  >
            tpgvIR
        </varlist>
        

        <varlist type="REAL"  >
            del
        </varlist>
        

        <varlist type="REAL"  >
            zWheel1,zTOFCend,zTIFCend,zTIFCFlangeBegin
        </varlist>
        
        <varlist type="REAL"  >
            qwe(10)
        </varlist>
        

        <varlist type="REAL"  >
            xHoles(0:15)
        </varlist>
        
        <varlist type="REAL"  >
            width1IOF(2),width2IOF(2),heightIOF(2),depthIOF(2)
        </varlist>
        

        <varlist type="INTEGER"  >
            inOut
        </varlist>
        

        <varlist type="REAL"  >
            zzzSA(2)
        </varlist>
        
        <varlist type="REAL"  >
            rmnSA(0:1)
        </varlist>
        
        <varlist type="REAL"  >
            rmxSA(0:1)
        </varlist>
        
<Export language="Mortran">
        <Data variables="zzzSA" values="207.4,219.1"  />
        <Data variables="rmnSA" values="51,121.07"    />
        <Data variables="rmxSA" values="121.07,194"   />
</Export>

<Export language="AgROOT">
        <Assign var="zzzsa" value="{207.4,219.1}" />
	<Assign var="rmnsa" value="{51,121.07}" />
	<Assign var="rmxsa" value="{121.07,194}" />
</Export>

        <varlist type="REAL"  >
            zzzWA(2)
        </varlist>
        
        <varlist type="REAL"  >
            rmnWA(0:1)
        </varlist>
        
        <varlist type="REAL"  >
            rmxWA(0:1)
        </varlist>
        
<Export language="Mortran">
        <Data variables="zzzWA" values="211.4,229.2"  />
        <Data variables="rmnWA" values="54,121"  />
        <Data variables="rmxWA" values="121,189"  />
</Export>

<Export language="AgROOT">
        <Assign var="zzzwa" value="{211.4,229.2}" />
        <Assign var="rmnwa" value="{54,121}" />
        <Assign var="rmxwa" value="{121,189}" />
</Export>

        <varlist type="REAL"  >
            zzzRDO(2)
        </varlist>
        
        <varlist type="REAL"  >
            rmnRDO(2)
        </varlist>
        
        <varlist type="REAL"  >
            rmxRDO(2)
        </varlist>
        

<Export language="Mortran">
        <Data variables="zzzRDO" values="232.,252."  />
        <Data variables="rmnRDO" values="88.,88."  />
        <Data variables="rmxRDO" values="198.,198."  />
</Export>

<Export language="AgROOT">
        <Assign var="zzzrdo" value="{232.,252.}" />
        <Assign var="rmnrdo" value="{88.,88.}" />
        <Assign var="rmxrdo" value="{198.,198.}" />
</Export>

        <varlist type="REAL"  >
            myCos,myRmin,myRmax,myG1,myG2
        </varlist>
        

        <varlist type="REAL"  >
            dRDOCooling(0:7)
        </varlist>
        

<Export language="Mortran">
        <Data variables="dRDOCooling" values=" 16.0, 16.0, 16.0, 16.7, 15.0, 3.5, 14.5, 0.0"  />
</Export>
<Export language="AgROOT">
        <Assign var="drdocooling" value="{16.0,16.0,16.0,16.7,15.0,3.5,14.5,0.0}" />
</Export>
        
        <varlist type="REAL"  >
            RCoolingTube/123456789/
        </varlist>
        
        <varlist type="CHARACTER*4"  >
            mySha
        </varlist>
        
        <varlist type="INTEGER"  >
            iCoo,iCab,jCoo,iRib,iTALS,jTALS
        </varlist>

	<!-- Primary configuration structure -->
        <Structure name="TPCC">
	  <var name="version" />
	  <var name="misalign" type="int"   />
	</Structure>
        
        <Structure name="TPCG"  >
            <var name="version" type="float"  />
            <var name="Rmin" type="float"  />
            <var name="Rmax" type="float"  />
            <var name="RminIFC" type="float"  />
            <var name="LengthT" type="float"  />
            <var name="Length" type="float"  />
            <var name="LengthW" type="float"  />
            <var name="LengthV" type="float"  />
            <var name="dZEnvelop" type="float"  />
            <var name="WheelIR" type="float"  />
            <var name="WheelR0" type="float"  />
            <var name="WheelR1" type="float"  />
            <var name="WheelR2" type="float"  />
            <var name="WheelTotalRibWidth" type="float"  />
            <var name="WheelRibWidth" type="float"  />
            <var name="WheelRibHeight" type="float"  />
            <var name="WheelBoxDx" type="float"  />
            <var name="WheelBoxDy" type="float"  />
            <var name="WheelOR1" type="float"  />
            <var name="WheelOR" type="float"  />
            <var name="WheelTHK1" type="float"  />
            <var name="WheelTHK" type="float"  />
            <var name="SenGasOR" type="float"  />
            <var name="MembTHK" type="float"  />
            <var name="tocsDR" type="float"  />
            <var name="tokaDR" type="float"  />
            <var name="tonxDR" type="float"  />
            <var name="toadDR" type="float"  />
            <var name="toigDR" type="float"  />
            <var name="toalDR" type="float"  />
            <var name="tohaDR" type="float"  />
            <var name="tiadDR" type="float"  />
            <var name="tinxDR" type="float"  />
            <var name="tikaDR" type="float"  />
            <var name="tialDR" type="float"  />
            <var name="tifcRF" type="float"  />
            <var name="tifcDRT" type="float"  />
            <var name="dzYF1" type="float"  />
            <var name="dzYF2" type="float"  />
            <var name="dzYF3" type="float"  />
            <var name="PadPlaneThickness" type="float"  />
            <var name="dGateGround" type="float"  />
            <var name="WireMountWidth" type="float"  />
            <var name="WireMountHeight" type="float"  />
            <var name="dxRDO" type="float"  />
            <var name="dyRDO" type="float"  />
            <var name="dzRDO" type="float"  />
            <var name="zRDO" type="float"  />
            <var name="heigTube" type="float"  />
            <var name="widTube" type="float"  />
            <var name="RDOCoolingdX" type="float"  />
            <var name="RDOCoolingdY" type="float"  />
            <var name="RDOCoolingdZ" type="float"  />
            <var name="zGatingGrid" type="float"  />
            <var name="zGroundGrid" type="float"  />
            <var name="DeadZone" type="float"  />
            <var name="dAnode(2)" type="float"  />
	    <var name="tofmax" />
	    <var name="IDeadZone" type="float" />
        </Structure>
        


        <Structure name="TPRS"  >
            <var name="sec" type="float"  />
            <var name="Nrow" type="float"  />
            <var name="pitch" type="float"  />
            <var name="width" type="float"  />
            <var name="super" type="float"  />
            <var name="dAnode" type="float"  />
            <var name="Rpads(40)" type="float"  />
            <var name="Npads(40)" type="float"  />
        </Structure>
        

        <Structure name="TECW"  >
            <var name="sec" type="float"  />
            <var name="GapWidI" type="float"  />
            <var name="GapWidO" type="float"  />
            <var name="GapHeit" type="float"  />
            <var name="GapRad" type="float"  />
            <var name="inwidth" type="float"  />
            <var name="ouwidth" type="float"  />
            <var name="widthLip" type="float"  />
            <var name="noribs" type="float"  />
            <var name="zStepRib" type="float"  />
            <var name="widthRib" type="float"  />
            <var name="Height" type="float"  />
            <var name="Thick" type="float"  />
            <var name="ThickAl" type="float"  />
            <var name="rMin" type="float"  />
            <var name="Rcenter" type="float"  />
            <var name="holeDx" type="float"  />
            <var name="holeDy" type="float"  />
        </Structure>
        

        <Structure name="TPCR"  >
            <var name="RdoVthk" type="float"  />
            <var name="Rdothk" type="float"  />
            <var name="Rdolen" type="float"  />
            <var name="NRdobrd" type="float"  />
            <var name="Rdoht(9)" type="float"  />
        </Structure>
        

        <Structure name="TFEE"  >
            <var name="Vers" type="float"  />
            <var name="CardDX" type="float"  />
            <var name="CardDY" type="float"  />
            <var name="CardDZ" type="float"  />
            <var name="PlateDX" type="float"  />
            <var name="PlateDY" type="float"  />
            <var name="PlateDZ" type="float"  />
            <var name="AssemblyThickness" type="float"  />
            <var name="RibDX" type="float"  />
            <var name="RibDY" type="float"  />
            <var name="RibDZ" type="float"  />
            <var name="Ass(3)" type="float"  />
        </Structure>
        


        <Structure name="RIBS"  >
            <var name="version" type="float"  />
            <var name="inout" type="float"  />
            <var name="num" type="float"  />
            <var name="x(16)" type="float"  />
            <var name="dx(16)" type="float"  />
            <var name="y(16)" type="float"  />
            <var name="dy(16)" type="float"  />
        </Structure>
        


        <Structure name="HOLZ"  >
            <var name="inout" type="int"  />
            <var name="numberofrows" type="int"  />
            <var name="numberperrow(16)" type="int"  />
            <var name="yholes(160)" type="float"  />
        </Structure>
        

        <Structure name="COOL"  >
            <var name="inout" type="int"  />
            <var name="tubeLength(16)" type="float"  />
        </Structure>

        <Fill name="TPCC" comment="Selected TPCG version subversion">
	  <var name="version" value="6.0" commenet="Default is 3.0" />
	  <var name="misalign" value="0" comment="0: ideal 1: global position" />
	</Fill>
        
        <Fill name="TPCG" comment="// TPC basic dimensions"  >
            <var name="version" value="6.0" comment="// version    =&gt; current version "  />
            <var name="Rmin" value="46.107" comment="// Rmin          =&gt; TPC envelope inner radius "  />
            <var name="Rmax" value="207.77" comment="// Rmax          =&gt; TPC envelope outer radius "  />
            <var name="RminIFC" value="46.6" comment="// RminIFC    =&gt; inner radius TPC IFC  : A.Lebedev measurement 10/16/08 "  />
            <var name="LengthT" value="2*271.0" comment="// LengthT    =&gt; TPC full length up to front of EEMC "  />
            <var name="Length" value="2*259.685" comment="// Length        =&gt; TPC full length including RDOs "  />
            <var name="LengthW" value="2*229.71" comment="// LengthW    =&gt; TPC length including Wheel "  />
            <var name="LengthV" value="2*210.00" comment="// LengthV    =&gt; TPC gas volume length "  />
            <var name="DzEnvelop" value="268." comment="// TPCE envelop dz "  />
            <var name="WheelIR" value="38.620*INCH/2" comment="// 49.60 WheelIR    =&gt; support wheel inner radius "  />
            <var name="WheelR0" value="21.500*INCH" comment="// WheelR0 =&gt; Distance from IP of end of inner cylindrical part "  />
            <var name="WheelR1" value="47.867*INCH" comment="// WheelR1 =&gt; Distance from IP of middle Rib "  />
            <var name="WheelR2" value="76.093*INCH" comment="// WheelR2 =&gt; Distance from IP of upper Rib "  />
            <var name="WheelTotalRibWidth" value="7.6" comment="// WheelTotalRibWidth =&gt; total rib width (A.Lebedev measurement) "  />
            <var name="WheelRibWidth" value="1.9" comment="// WheelRibWidth         =&gt; rib plate width (A.Lebedev measurement) "  />
            <var name="WheelRibHeight" value="1.3" comment="// WheelRibHeight        =&gt; rib plate height (A.Lebedev measurement) "  />
            <var name="WheelBoxDx" value="4.7" comment="// WheelBoxDx (A.Lebedev measurement) "  />
            <var name="WheelBoxDy" value="7.6" comment="// WheelBoxDy (A.Lebedev measurement) "  />
            <var name="WheelOR1" value="201.0" comment="// WheelOR1   =&gt; @ TOFC "  />
            <var name="WheelOR" value="206.75" comment="// WheelOR    =&gt; support wheel outer radius "  />
            <var name="WheelTHK1" value="5.72" comment="// WheelTHK1 "  />
            <var name="WheelTHK" value="11.43" comment="// WheelTHK   =&gt; support wheel length "  />
            <var name="SenGasOR" value="200" comment="// SenGasOR   =&gt; TPC sensitive gas outer radius "  />
            <var name="MembTHK" value="0.00762" comment="// MembTHK    =&gt; Central membrane thickness "  />
            <var name="tocsDR" value="0.013" comment="// tocsDR        =&gt; outer copper thickness:  NIM A499 (2003) 659-678 Table 2 "  />
            <var name="tokaDR" value="0.015" comment="// tokaDR        =&gt; outer kapton thickness "  />
            <var name="tonxDR" value="0.953" comment="// tonxDR        =&gt; outer nomex thickness "  />
            <var name="toadDR" value="0.05" comment="// toadDR        =&gt; outer adhesive thickness "  />
            <var name="toigDR" value="5.70" comment="// toigDR        =&gt; outer isolating gas thickness "  />
            <var name="toalDR" value="0.40" comment="// toalDR        =&gt; outer aluminum thickness (for both layers) "  />
            <var name="tohaDR" value="0.60" comment="// tohaDR        =&gt; outer Honeycomb Al thickness "  />
            <var name="tiadDR" value="0.080" comment="// tiadDR        =&gt; inner adhesive layer thickness:  NIM A499 (2003) 659-678 Table 2 "  />
            <var name="tinxDR" value="1.270" comment="// tinxDR        =&gt; inner nomex structureure thickness "  />
            <var name="tikaDR" value="0.015" comment="// tikaDR        =&gt; inner Kapton layer thickness "  />
            <var name="tialDR" value="0.004" comment="// tialDR        =&gt; inner aluminum layer thickness "  />
            <var name="tifcRF" value="51.7" comment="// tifcRF        =&gt; outer radius of IFC flange "  />
            <var name="tifcDRT" value="0.1" comment="// tifcDRT    =&gt; tolerance between flange and wheel "  />
            <var name="dzYF1" value="221.162" comment="// dz of YF1 "  />
            <var name="dzYF2" value="211.9" comment="// dz of YF2 "  />
            <var name="dzYF3" value="208.02" comment="// dz of YF3 "  />
            <var name="PadPlaneThickness" value="0.182" comment="// 1.82 mm  Drawing 24A0314 &amp; 24A0304 "  />
            <var name="dGateGround" value="0.6" comment="// "  />
            <var name="WireMountWidth" value="5*((0.130+0.1376)/2)*INCH" comment="// "  />
            <var name="WireMountHeight" value="1.340*inch" comment="// Drawing 24A0434 "  />
            <var name="dxRDO" value="1.75/2" comment="// A.Lebedev 1 RDO = 5 lb "  />
            <var name="dyRDO" value="45./2" comment="// "  />
            <var name="dzRDO" value="17.0/2" comment="// "  />
            <var name="zRDO" value="TPCG_LengthW/2 + 20.0" comment="// "  />
            <var name="heigTube" value="0.703*INCH" comment="// x Cooling TUBE Drawing 24A0801B "  />
            <var name="widTube" value="0.500*INCH" comment="// z Mixture TPCE_Water_Pipe =&gt; rho = 2.32155 g/cm**3 "  />
            <var name="RDOCoolingdX" value="(38.0 + 9.0 + 58.0)/2" comment="// "  />
            <var name="RDOCoolingdY" value="1.25" comment="// "  />
            <var name="RDOCoolingdZ" value="2.50" comment="// "  />
            <var name="dAnode" value="{0.2 ,0.4 }" comment="// Inner/Outer anode width "  />
            <var name="zGatingGrid" value="TPCG_LengthV/2 -(TPCG_dGateGround+2*TPCG_dAnode(2))" comment="//  "  />
            <var name="zGroundGrid" value="TPCG_zGatingGrid+TPCG_dGateGround" comment="// "  />
            <var name="DeadZone" value="14." comment="// Dead zone before GatingGrid. No hits there "  />
            <var name="IDeadZone" value="14." comment="// Dead zone before GatingGrid. (inner) No hits there "  />
	    <var name="tofmax"   value="32.0E-6" comment="// Max time of flight" />
        </Fill>

        <Fill name="TPCG" comment="// TPC basic dimensions"  >
            <var name="version" value="6.1" comment="// version    =&gt; current version "  />
            <var name="DeadZone" value="13." comment="// Dead zone before GatingGrid. No hits there "  />
            <var name="IDeadZone" value="12.4" comment="// Dead zone before GatingGrid. (inner) No hits there "  />
	</Fill>

        
	<Use struct="TPCC" />
        <Use struct="TPCG" select="version" value="TPCC_version" />

        <Fill name="TPRS" comment="// sector of padrows"  >
            <var name="sec" value="1" comment="// sector number: 1 for inner, 2 for outer "  />
            <var name="nRow" value="40" comment="// number of padrows in the sector "  />
	    <var name="pitch" value="0.5" comment="// tpc padrow pitch width // IRAKLI : I believe it is pad pitch in pad rows"  />
            <var name="width" value="1.55" comment="// tpc padrow thickness "  />
            <var name="super" value="1" comment="// number of padraws in a superpadrow "  />
            <var name="dAnode" value="0.2" comment="// distance to anode wire from pad plane "  />
            <var name="Npads" value="{52, 54, 56, 58, 60, 62, 62, 64, 66, 68, 70, 72, 74, 74, 76, 78, 80, 82, 84, 86, 86, 88, 90, 92, 94, 96, 98, 98,100,102, 104,106,108,110,110,112,114,116,118,120}" comment="// number of pads in row "  />
	    <var name="Rpads" value="{55.8,57.4,59.0,60.6,62.2,63.8,65.4,67.0,68.6,70.2,71.8,73.4,75.0,76.6,78.2,79.8,81.4,83.0,84.6,86.2,87.8,89.4,91.0,92.6,94.2,95.8,97.4,99.0,100.6,102.2,103.8,105.4,107.0,108.6,110.2,111.8,113.4,115.0,116.6,118.2}" comment="// tpc padrow radii // IRAKLI : 55.8 + n*1.6"  />
        </Fill>
        
        <Fill name="TPRS" comment="// sector of padrows"  >
            <var name="sec" value="2" comment="// sector number: 1 for inner, 2 for outer "  />
            <var name="nRow" value="32" comment="// number of padrows in outer sector "  />
            <var name="pitch" value="0.67" comment="// outer tpc padrow pitch width "  />
            <var name="width" value="1.95" comment="// outer tpc padrow thickness "  />
            <var name="super" value="1" comment="// number of padrows in a superpadrow "  />
            <var name="dAnode" value="0.4" comment="// distance to anode wire from pad plane "  />
            <var name="Npads" value="{98,100,102,104,106,106,108,110,112,112 ,114,116,118,120,122,122,124,126,128 ,128,130,132,134,136,138,138,140,142 ,144,144,144,144 }" comment="// number of pads in row "  />
            <var name="Rpads" value="{127.195,129.195,131.195,133.195,135.195,137.195,139.195,141.195,143.195,145.195,147.195,149.195,151.195,153.195,155.195,157.195,159.195,161.195,163.195,165.195,167.195,169.195,171.195,173.195,175.195,177.195,179.195,181.195,183.195,185.195,187.195,189.195 }" comment="// tpc padrow radii "  />
        </Fill>
        
        <Use struct="TPRS"  />

        <Fill name="TECW" comment="// EC trapezoid and support Wheel"  >
            <var name="sec" value="1" comment="// sec   =&gt; sector number: 1 for inner, 2 for outer "  />
            <var name="GapWidI" value="2.* 10.91" comment="// GapWidI  =&gt; air in support wheel - inner width "  />
            <var name="GapWidO" value="2.* 27.56" comment="// GapWidO  =&gt; air in support wheel - outer width "  />
            <var name="GapHeit" value="62.15" comment="// GapHeit  =&gt; air in support wheel - Height (dr) "  />
            <var name="GapRad" value="87.0" comment="// GapRad   =&gt; air in support wheel - center radius "  />
            <var name="inwidth" value="10.829*INCH" comment="//2.* 13.75,   !// inwidth  =&gt; sector width at inner radius "  />
            <var name="ouwidth" value="25.498*INCH" comment="//2.* 32.38,   !// ouwidth  =&gt; sector width at outer radius "  />
            <var name="noribs" value="11" comment="// noribs "  />
            <var name="zStepRib" value="3.150*INCH" comment="// zStepRib "  />
            <var name="widthRib" value="1.47*COS(15./180*ACOS(-1.))*INCH" comment="// widthRib =&gt; side rib width "  />
            <var name="Height" value="27.373*INCH" comment="// Drawing 24A3685B 27.77*INCH from drawing 24A0325,     !// =&gt; 69.527 =&gt; (Wire Plane)  69.52,  Height   =&gt; sector radial Height"  />
            <var name="Thick" value="3.300*INCH" comment="// 24A3685B  3.219*INCH        !// Thick    =&gt; sector thickness "  />
            <var name="thickAl" value="0.375*INCH" comment="//  "  />
            <var name="rMin" value="51.905" comment="// rMin     =&gt; Minimum distance to beam line (wire plane) "  />
            <var name="Rcenter" value="86.669" comment="// Rcenter  =&gt; sector center radius (set by precision holes) "  />
            <var name="holeDx" value="0.750/2*INCH" comment="// = 0.9525 cm "  />
            <var name="holeDy" value="2.625/2*inch" comment="// = 3.33375 cm "  />
        </Fill>
        

        <Fill name="TECW" comment="// EC trapezoid and support Wheel"  >
            <var name="sec" value="2" comment="// sec    =&gt; sector number: 1 for inner, 2 for outer "  />
            <var name="GapWidI" value="2.* 28.92" comment="// GapWidI  =&gt; air in support wheel - inner width "  />
            <var name="GapWidO" value="2.* 46.74" comment="// GapWidO  =&gt; air in support wheel - outer width "  />
            <var name="GapHeit" value="65.0" comment="// GapHeit  =&gt; air in support wheel - Height (dr) "  />
            <var name="GapRad" value="158.0" comment="// aGapRad   =&gt; ir in support wheel - radius "  />
            <var name="inwidth" value="25.561*INCH" comment="//64.92,       !// inwidth  =&gt; sector width at inner radius "  />
            <var name="ouwidth" value="40.649*INCH" comment="//103.25,      !// ouwidth  =&gt; sector width at outer radius "  />
            <var name="widthLip" value="((25.561-24.583)+(40.649-39.671))/4*INCH" comment="// = 1.242060 widthLip =&gt;  width of lip "  />
            <var name="noribs" value="14" comment="// noribs "  />
            <var name="zStepRib" value="3.150*INCH" comment="// zStepRib "  />
            <var name="widthRib" value="1.47*COS(15./180*ACOS(-1.))*INCH" comment="// widthRib = &gt; side rib width "  />
            <var name="Height" value="28.155*INCH" comment="// 71.514 (Wire Plane) =&gt; 71.51,       !// Height   =&gt; sector radial Height "  />
            <var name="Thick" value="3.140*INCH" comment="// 24A3925G thick    =&gt; sector thickness "  />
            <var name="ThickAl" value="0.375*INCH" comment="//  "  />
            <var name="rMin" value="121.732" comment="// rMin     =&gt; Minimum distance to beam line (wire plane) "  />
            <var name="Rcenter" value="157.488" comment="// Rcenter  =&gt; sector center radius (set by precision holes) "  />
            <var name="holeDx" value="0.750/2*INCH" comment="// "  />
            <var name="holeDy" value="2.500/2*INCH" comment="// "  />
        </Fill>
        
        <Fill name="TPCR" comment="// volume for tpc readout boards"  >
            <var name="RdoVthk" value="30." comment="// length of RDO volume "  />
            <var name="Rdothk" value=".25" comment="// thickness of rdo card "  />
            <var name="Rdolen" value="27" comment="// card length along beam direction "  />
            <var name="NRdobrd" value="9" comment="// number of RDO boards "  />
            <var name="Rdoht" value="{60.0,74.0,84.0,101.0,106.0,126.0,146.0,166.0,186.0}" comment="// radial pos of rdo boards "  />
        </Fill>
        
        <Fill name="TFEE" comment="// frontEndElectronics"  >
            <var name="Vers" value="1" comment="// version of FrontEndElectronics "  />
            <var name="CardDX" value="1.47*0.110*INCH/2" comment="// 1.47 scale factor account for 9 lb of cables "  />
            <var name="CardDY" value="2.900*INCH/2" comment="//... "  />
            <var name="CardDZ" value="7.000*INCH/2" comment="//... "  />
            <var name="PlateDX" value="0.110*INCH/2" comment="//... "  />
            <var name="PlateDY" value="1.480*INCH" comment="//... "  />
            <var name="PlateDZ" value="4.650*INCH/2" comment="//... "  />
            <var name="AssemblyThickness" value="TFEE_CardDX + TFEE_PlateDX" comment="//... "  />
            <var name="RibDX" value="0.820*INCH/2 - 2*   TFEE_CardDX" comment="//... "  />
            <var name="RibDY" value="2.900*INCH/2 - 2*   TFEE_CardDX" comment="//... "  />
            <var name="RibDZ" value="TFEE_CardDX" comment="//... "  />
            <var name="Ass" value="{1.6,4,10}" comment="// Fee assembly brik size "  />
        </Fill>
        


        <Use struct="TECW" select="sec" value="kInner+1 "  />
        <Fill name="RIBS" comment="// Rib structure / inner Drawing 24A3925G"  >
            <var name="version" value="kInner" comment="// version number "  />
            <var name="inout" value="kInner" comment="// selctor "  />
            <var name="num" value="11" comment="// number of elements  "  />
            <var name="x" value="{0.000,4.261,10.561,16.861,23.161,25.950,3.726,3.726,10.026,10.026,25.480 }" comment="// x "  />
            <var name="y" value="{0.000,0.000,0.000,0.000,0.000,0.000,-5.645,5.645,-3.895,3.895,0.000        }" comment="// y   "  />
            <var name="dx" value="{1.470,0.375,0.375 ,0.375 ,0.375 ,TECW_Height/INCH-25.950,1.070,1.070,1.070,1.070,0.940 }" comment="// dx  ... last=2*(25.950-(1.050+2.515+21.915))  "  />
            <var name="dy" value="{0.,0.,0.,0.,0.,0.,0.750,0.750,0.750,0.750,2.0}" comment="// dy  "  />
        </Fill>
        

        <Use struct="TECW" select="sec" value="kOuter+1 "  />
        <Fill name="RIBS" comment="// Rib structure / outer Drawing 24A3925G"  >
            <var name="version" value="kOuter" comment="// version number "  />
            <var name="inout" value="kOuter" comment="// selctor "  />
            <var name="num" value="14" comment="// number of elements  "  />
            <var name="x" value="{0.280,4.261,7.410,10.560,13.710,16.859,20.009,23.158,26.309,6.023,6.023,12.3225,15.472,26.309-1.575/2}" comment="// x "  />
            <var name="y" value="{0,0,0,0,0,0,0,0,0,17.250/2,-17.250/2,0,0,0}" comment="// y "  />
            <var name="dx" value="{1.268,0.375,0.375,0.375,0.375,0.375,0.375,0.375,1.566,2.774,2.774,2.775,2.774,1.575 }" comment="// dx "  />
            <var name="dy" value="{0,0,0,0,0,0,0,0,0,1.250,1.250,0.375,0.375,1.5680}" comment="// dy "  />
        </Fill>
        


        <Fill name="HOLZ" comment="// holes per row inner"  >
            <var name="inout" value="kInner" comment="// selector "  />

            <var name="numberOfRows" value="15" comment="// Number of rows "  />
            <var name="numberPerRow" value="{6,5,5,2,5,4,4,4,4,3,3,3,3,2,2,0 }" comment="// n/row "  />

            <var name="yholes" value="{3.180*(-2.5+0),3.180*(-2.5+1),3.180*(-2.5+2),3.180*(-2.5+3),3.180*(-2.5+4),3.180*(-2.5+5),3.180*(-2.5+6),3.180*(-2.5+7),3.180*(-2.5+8),3.764*(-2.0+0),3.764*(-2.0+1),3.764*(-2.0+2),3.764*(-2.0+3),3.764*(-2.0+4),3.764*(-2.0+5),3.764*(-2.0+6),3.764*(-2.0+7),3.764*(-2.0+8),3.553*(-2.0+0),3.553*(-2.0+1),3.553*(-2.0+2),3.553*(-2.0+3),3.553*(-2.0+4),3.553*(-2.0+5),3.553*(-2.0+6),3.553*(-2.0+7),3.553*(-2.0+8),13.368*(-0.5+0),13.368*(-0.5+1),13.368*(-0.5+2),13.368*(-0.5+3),13.368*(-0.5+4),13.368*(-0.5+5),13.368*(-0.5+6),13.368*(-0.5+7),13.368*(-0.5+8),3.131*(-2.0+0),3.131*(-2.0+1),3.131*(-2.0+2),3.131*(-2.0+3),3.131*(-2.0+4),3.131*(-2.0+5),3.131*(-2.0+6),3.131*(-2.0+7),3.131*(-2.0+8),-3.892 - 1.948 ,-1.948        ,+1.948        ,3.892 + 1.948 ,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,-3.611 - 1.807 ,-1.807        ,+1.807        ,3.611 + 1.807 ,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,-3.281 - 1.7145,-1.7145       ,+1.7145       ,3.281 + 1.7145,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,3.150*(-1.5+0),3.150*(-1.5+1),3.150*(-1.5+2),3.150*(-1.5+3),3.150*(-1.5+4),3.150*(-1.5+5),3.150*(-1.5+6),3.150*(-1.5+7),3.150*(-1.5+8),4.152*(-1.0+0),4.152*(-1.0+1),4.152*(-1.0+2),4.152*(-1.0+3),4.152*(-1.0+4),4.152*(-1.0+5),4.152*(-1.0+6),4.152*(-1.0+7),4.152*(-1.0+8),3.730*(-1.0+0),3.730*(-1.0+1),3.730*(-1.0+2),3.730*(-1.0+3),3.730*(-1.0+4),3.730*(-1.0+5),3.730*(-1.0+6),3.730*(-1.0+7),3.730*(-1.0+8),3.308*(-1.0+0),3.308*(-1.0+1),3.308*(-1.0+2),3.308*(-1.0+3),3.308*(-1.0+4),3.308*(-1.0+5),3.308*(-1.0+6),3.308*(-1.0+7),3.308*(-1.0+8),3.075*(-1.0+0),3.075*(-1.0+1),3.075*(-1.0+2),3.075*(-1.0+3),3.075*(-1.0+4),3.075*(-1.0+5),3.075*(-1.0+6),3.075*(-1.0+7),3.075*(-1.0+8),4.927*(-0.5+0),4.927*(-0.5+1),4.927*(-0.5+2),4.927*(-0.5+3),4.927*(-0.5+4),4.927*(-0.5+5),4.927*(-0.5+6),4.927*(-0.5+7),4.927*(-0.5+8),4.083*(-0.5+0),4.083*(-0.5+1),4.083*(-0.5+2),4.083*(-0.5+3),4.083*(-0.5+4),4.083*(-0.5+5),4.083*(-0.5+6),4.083*(-0.5+7),4.083*(-0.5+8),0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,0.000         ,0.000                 }" comment="// y holes "  />
        </Fill>
        

        <Fill name="HOLZ" comment="// holes per row outer"  >
            <var name="inout" value="kOuter" comment="// selector "  />
            <var name="numberOfRows" value="16" comment="// Number of rows "  />
            <var name="numberPerRow" value="{9,9,9,9,9,8,8,8,8,8,7,7,7,7,7,6 }" comment="// n/row "  />
            <var name="yholes" value="{-15.025,-11.606,-8.177,-4.220,0,4.220,8.177,11.606,15.025,-15.025,-11.606,-8.177,-4.220,0,4.220,8.177,11.606,15.025,-14.243,-11.078,-6.330,-3.165,0,3.165,6.330,11.078,14.243,-14.243,-11.078,-6.330,-3.165,0,3.165,6.330,11.078,14.243,-13.452,-10.023,-6.330,-3.165,0,3.165,6.330,10.023,13.452,-13.452,-10.023,-6.330,-3.165,3.165,6.330,10.023,13.452,0,-12.660,-9.495,-6.330,-2.110,2.110,6.330,9.495,12.660,0,-12.660,-9.495,-6.330,-2.110,2.110,6.330,9.495,12.660,0,-11.870,-8.440,-5.275,-2.110,2.110,5.275,8.440,11.870,0,-11.870,-8.440,-5.275,-2.110,2.110,5.275,8.440,11.870,0,-11.078,-7.649,-4.220,0,4.220,7.649,11.078,0,0,-11.078,-7.649,-4.220,0,4.220,7.649,11.078,0,0,-10.022,-6.858,-3.429,0,3.429,6.858,10.022,0,0,-10.022,-6.858,-3.429,0,3.429,6.858,10.022,0,0,-9.495,-6.330,-3.165,0,3.165,6.330,9.495,0,0,-9.495,-6.330,-3.165,3.165,6.330,9.495,0,0,0 }" comment="// y holes "  />
        </Fill>
        


        <Fill name="COOL" comment="// Cooling tube lengths / inner"  >
            <var name="inout" value="kInner" comment="// Inner vs outer "  />
            <var name="tubeLength" value="{19.300,18.454,17.610,16.766,15.922,15.078,14.235,13.390,12.546,11.704,10.860,10.016,9.172,8.327,7.483,0.000 }" comment="// Tube lengths "  />
        </Fill>
        

        <Fill name="COOL" comment="// Cooling tube lengths / outer"  >
            <var name="inout" value="kOuter" comment="// Inner vs outer "  />
            <var name="tubeLength" value="{33.620,33.605,32.761,31.917,31.073,30.229,29.385,28.541,27.697,26.853,26.009,25.165,24.321,23.478,22.634,21.790 }" comment="// Tube lengths "  />
        </Fill>
        

        <Use struct="TFEE"  />

        <Use struct="TECW"  />
        <Use struct="TPCR"  />
<!--
	<Use struct="TPCC"                                             />
        <Use struct="TPCG"    select="version"    value="TPCC_version" />
-->



        tofcLENG = tpcg_Length-2*tpcg_WheelTHK-2*TPCR_RdoVthk  ! gas plus endcaps 
        tpgvLeng = (tofcLeng-tpcg_MembTHK)/2          ! active gas 
        tpgvLeng = (TPCG_LengthV-tpcg_MembTHK)/2      ! active gas 


        tocsIR = TPCG_SenGasOR
        tocsOR = tocsIR + TPCG_tocsDR
        tokaIR = tocsOR; tokaOR = tokaIR + TPCG_tokaDR
        tonxIR = tokaOR; tonxOR = tonxIR + TPCG_tonxDR
        toadIR = tonxOR; toadOR = toadIR + TPCG_toadDR

        toigIR = toadOR; toigOR = toigIR + TPCG_toigDR
        toalIR = toigOR; toalOR = toalIR + TPCG_toalDR/2.
        tohaIR = toalOR; tohaOR = tohaIR + TPCG_tohaDR
        toalIR2= tohaOR; toalOR2= toalIR2+ TPCG_toalDR/2.

        tofcIR = tocsIR; tofcOR = toalOR2
        tofsIR = tocsIR; tofsOR = toadOR

        tifcIR = TPCG_RminIFC
        tialIR = tifcIR; tialOR = tialIR + TPCG_tialDR/2.
        tikaIR = tialOR; tikaOR = tikaIR + TPCG_tikaDR
        tinxIR = tikaOR; tinxOR = tinxIR + TPCG_tinxDR
        tiadIR = tinxOR; tiadOR = tiadIR + TPCG_tiadDR
        tifcOR = tiadOR + TPCG_tialDR/2.

        tpgvIR = tifcOR;         !// TPC gas inner radius 
        del = TPCG_Rmax-tofcOR

        <Print level="0" fmt="' TPCE: config=',F9.3"  >
            TPCG_version
        </Print>
        

        <Assign var="width1IOF" value="{ 7.661*inch, 22.287*inch}" />
	<Assign var="width2IOF" value="{20.552*inch, 35.422*inch}" />
        <Assign var="heightIOF" value="{24.222*inch, 24.840*inch}" />
        <Assign var="depthIOF"  value="{ 1.800*inch,  1.800*inch}" />

        <Mixture name="Nomex" dens="0.064"  >
            <Component name="C" a="12" z="6" w="5"  />
            <Component name="H" a="1" z="1" w="8"  />
            <Component name="O" a="16" z="8" w="2"  />
        </Mixture>
        

        <Mixture name="Adhesive" dens="1.2"  >
            <Component name="C" a="12" z="6" w="0.625"  />
            <Component name="H" a="1" z="1" w="0.4166667E-01"  />
            <Component name="O" a="16" z="8" w="0.3333333"  />
        </Mixture>
        

        <Mixture name="Al_honeycomb" dens="0.282"  >
            <Component name="Al" a="27" z="13" w="0.0105"  />
            <Component name="N" a="14" z="7" w="0.7395"  />
            <Component name="Adhesive" a="9" z="4.5" w="0.2500"  />
        </Mixture>
        

        <Mixture name="G10" dens="1.7"  >
            <Component name="Si" a="28.08" z="14" w="0.6*1*28./60."  />
            <Component name="O" a="16" z="8" w="0.6*2*16./60. + 0.4*4*16./174."  />
            <Component name="C" a="12" z="6" w="0.4*8*12./174."  />
            <Component name="H" a="1"  z="1" w="0.4*14*1./174."  />
        </Mixture>
        
        <!-- <Material name="G10"  /> -->

        <Mixture name="Water_Pipe" dens="2.32155"  >
            <Component name="H" a="1" z="1" w="1.06546299984001044e-02"  />
            <Component name="O" a="16" z="8" w="8.52370399872008355e-02"  />
            <Component name="AL" a="27" z="14" w="9.04108330014399053e-01"  />
        </Mixture>
        
        <!-- <Material name="Water_Pipe"  /> -->

        <Mixture name="Cables" dens="2.68"  >
            <Component name="CU" a="63.54" z="29" w="0.586"  />
            <Component name="C" a="12.01" z="6" w="0.259"  />
            <Component name="O" a="15.999" z="8" w="0.138"  />
            <Component name="H" a="1.00794" z="1" w="0.017"  />
        </Mixture>
        
        <!-- <Material name="Cables"  /> -->

        <Mixture name="P10" dens="0.154053E-02"  >
            <Component name="Ar" a="40" z="18" w="9"  />
            <Component name="C" a="12" z="6" w="1"  />
            <Component name="H" a="1" z="1" w="4"  />
        </Mixture>
        
        <Create    block="TPCE"  />

        <Placement block="TPCE" in="CAVE" group="TpcRefSys"     if="TPCC_misalign.eq.0" />
        <Placement block="TPCE" in="CAVE" group="TpcRefSys"     if="TPCC_misalign.eq.1"  >
	  <Misalign table="TpcPosition" row="0" /><!-- apply TPC global position -->
	</Placement>



	<!--                                                                                        TPCE -->
        <Block name="TPCE" comment="is the TPC envelope"  >

            <Material name="Air"  />
	    <Medium   name="Standard" />

            <Attribute for="TPCE" seen="0" colo="kRed"  />
            <Shape type="TUBE" rmax="tpcg_rmax" rmin="tpcg_rmin" dz="tpcg_DzEnvelop"  />

            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            

            tpgvz  = (tpcg_MembTHK + tpgvLeng)/2                
            zWheel1  = TPCG_LengthW/2 - TPCG_WheelTHK;        
            zTOFCend = TPCG_LengthW/2 - TPCG_WheelTHK1;       
            zTIFCend = TPCG_LengthW/2 + 0.97;                 
            zTIFCFlangeBegin = zTIFCend - 1*INCH;             

            <Create block="TPGV"  />

            <Placement block="TPGV" z="+tpgvz" konly="'MANY'"   >
                <Rotation thetaz="0" thetax="90" thetay="90" phiz="0" phiy="-15" phix="75"  />
            </Placement>
            
            <Placement block="TPGV" z="-tpgvz" konly="'MANY'"   >
                <Rotation thetaz="180" thetax="90" thetay="90" phiz="0" phiy="195" phix="105"  />
            </Placement>
                     
	    <Create    block="TPCM"  />
            <Placement block="TPCM"  />

            <Create    block="TIFC"  />
            <Placement block="TIFC"  />
            
            <Create    block="TOFC"  />
            <Placement block="TOFC"  />           

            <Do var="iSecAng" from="0" to="360-30" step="30"  >

                <Create    block="TSWH"  />
                <Placement block="TSWH"  konly="'MANY'" >
                    <Rotation alphaz="iSecAng"  />
                </Placement>
                
                <Create block="TSWH"  />
                <Placement block="TSWH"  konly="'MANY'" >
                    <Rotation ort="XY-Z"  />
                    <Rotation alphaz="iSecAng"  />
                </Placement>

                
            </Do>
            

        </Block>
        

	<!--                                                                                        TPCM -->
        <Block name="TPCM" comment="is the Central Membrane placed in TPC"  >

            <Material name="Mylar"  />
            <Attribute for="TPCM" seen="1" colo="kBlue"  />
            <Shape type="TUBE" rmax="tpcg_SenGasOR" rmin="tpgvIR" dz="tpcg_MembTHK/2"  />

        </Block>
        

	<!--                                                                                        TIFC -->
        <Block name="TIFC" comment="defines the Inner Field Cage placed in TPC"  >

            <Material name="ALUMINIUM"  />
            <Attribute for="TIFC" seen="1" colo="kBlue"  />
            <Shape type="PCON" zi="{-zTIFCend,-zTIFCFlangeBegin,-zTIFCFlangeBegin,zTIFCFlangeBegin,zTIFCFlangeBegin,zTIFCend}" rmn="{tifcIR,tifcIR,tifcIR,tifcIR,tifcIR,tifcIR}" rmx="{TPCG_tifcRF,TPCG_tifcRF,tifcOR,tifcOR,TPCG_tifcRF,TPCG_tifcRF}" nz="6" phi1="0" dphi="360"  />

            <Create block="TIKA"  />           <Placement block="TIKA"  />            
            <Create block="TINX"  />           <Placement block="TINX"  />            
            <Create block="TIAD"  />           <Placement block="TIAD"  />
            
        </Block>
        

	<!-- Kapton layer in IFC                                                                    TIKA -->
        <Block name="TIKA" comment="is the kapton film of the inner field cage"  >
            <Material  name="Mylar"  />
            <Attribute for="TIKA" seen="1" colo="kViolet"  />
            <Shape     type="TUBE" rmax="tikaOR" rmin="tikaIR" dz="TPCG_dzYF1"  />
        </Block>
        
	<!-- Nomex layer in IFC                                                                     TIKA -->
        <Block name="TINX" comment="is the inner nomex structureure"  >
            <Material name="Nomex"  />
            <Attribute for="TINX" seen="1" colo="kYellow"  />
            <Shape type="TUBE" rmax="tinxOR" rmin="tinxIR" dz="TPCG_dzYF1"  />
        </Block>
        
	<!-- Adhesive layer in IFC                                                                  TIKA -->
        <Block name="TIAD" comment="the inner adhesive structureure"  >
            <Material name="ADHESIVE"  />
            <Attribute for="TIKA" seen="1" colo="kViolet"  />
            <Shape type="TUBE" rmax="tiadOR" rmin="tiadIR" dz="TPCG_dzYF1"  />
        </Block>
        

	<!-- Outer field cage                                                                       TOFC -->
        <Block name="TOFC" comment="defines outer field cage - fill it WITH insulating gas already"  >

            <Material  name="ALUMINIUM"  />
            <Attribute for="TOFC" seen="1" colo="kGreen"  />
            <Shape     type="PCON" zi="{-zTOFCend,-zWheel1,-zWheel1,zWheel1,zWheel1,zTOFCend}" rmn="{TPCG_WheelOR1,TPCG_WheelOR1,tofcIR,tofcIR,TPCG_WheelOR1,TPCG_WheelOR1}" rmx="{TPCG_WheelOR,TPCG_WheelOR,tofcOR,tofcOR,TPCG_WheelOR,TPCG_WheelOR}" nz="6" phi1="0" dphi="360"  />

            <Create block="TOAD"  />            <Placement block="TOAD"  />
            <Create block="TOFS"  />            <Placement block="TOFS"  />
            <Create block="TOKA"  />            <Placement block="TOKA"  />
            <Create block="TONX"  />            <Placement block="TONX"  />
            
            <Create block="TOIG"  />            <Placement block="TOIG"  />
            <Create block="TOHA"  />            <Placement block="TOHA"  />

        </Block>
        

            <Block name="TOFS" comment="is the Outer Field Cage structureure"  >
            <Material name="COPPER"  />
            <Medium name="TOFS_copper" isvol="0" ifield="1" fieldm="20" tmaxfd="20" stemax="10" deemax="0.25" epsil="0.01" stmin="0.0281386" />
            <Attribute for="TOFS" seen="1" colo="kBlue"  />
            <Shape type="TUBE" rmax="tocsOR" rmin="tocsIR" dz="TPCG_dzYF2"  />
            </Block>

            <Block name="TOKA" comment="is MYLAR layer"  >
            <Material name="mylar"  />
            <Attribute for="TOKA" seen="1" colo="kGreen"  />
            <Shape type="TUBE" rmax="tokaOR" rmin="tokaIR" dz="TPCG_dzYF2"  />
            </Block>
        
            <Block name="TONX" comment="is Nomex support"  >
            <Material name="Nomex"  />
            <Attribute for="TONX" seen="1" colo="kRed"  />
            <Shape type="PCON" zi="{-TPCG_dzYF2,-TPCG_dzYF3,-TPCG_dzYF3,TPCG_dzYF3,TPCG_dzYF3,TPCG_dzYF2}" rmn="{tonxOR-0.2,tonxOR-0.2,tonxIR,tonxIR,tonxOR-0.2,tonxOR-0.2}" rmx="{tonxOR,tonxOR,tonxOR,tonxOR,tonxOR,tonxOR}" nz="6" phi1="0" dphi="360"  />
            </Block>

            <Block name="TOAD" comment="is Adhesive layer"  >
            <Material name="mylar"  />
            <Attribute for="TOAD" seen="1" colo="kLightBlue"  />
            <Shape type="TUBE" rmax="toadOR" rmin="toadIR" dz="TPCG_dzYF2"  />
            </Block>
        
            <Block name="TOIG" comment="is Insulating Gas (Nitrogen)"  >
            <Material name="NITROGEN_GAS"  />
            <Attribute for="TOAD" seen="1" colo="kLightBlue"  />
            <Shape type="TUBE" rmax="toigOR" rmin="toigIR" dz="TPCG_dzYF2"  />
            </Block>
        
            <Block name="TOHA" comment="Gas Containment Vessel (Al) + HA"  >
            <Material name="AL_HONEYCOMB"  />
            <Attribute for="TOHA" seen="1" colo="kViolet"  />
            <Shape type="TUBE" rmax="tohaOR" rmin="tohaIR" dz="TPCG_dzYF3"  />
            </Block>

        <!--                                                                             end outer field cage -->
        




        <Block name="TSWH" comment="TpcSectorWhole is Sector as Whole"  >

<!--        <Medium name="TSWH_STANDARD" deemax="0.248853" stmin="1.15055" /> -->
            <Medium name="STANDARD" /> 
            <Attribute for="TSWH" seen="1" colo="kViolet"  />
            <Shape type="PCON" zi="{TPCG_MembTHK/2,zWheel1,zWheel1,zTOFCend,zTOFCend,zTIFCFlangeBegin,zTIFCFlangeBegin,TPCG_DzEnvelop}" rmn="{tifcOR,tifcOR,tifcOR,tifcOR,tifcOR,TPCG_tifcRF+TPCG_tifcDRT,TPCG_tifcRF+TPCG_tifcDRT,TPCG_tifcRF+TPCG_tifcDRT}" rmx="{tofcIR,tofcIR,TPCG_WheelOR1,TPCG_WheelOR1,TPCG_WheelOR,TPCG_WheelOR,TPCG_WheelOR,TPCG_WheelOR}" nz="8" phi1="-15" dphi="30"  />

            <Create block="TSAW" /><Placement block="TSAW" konly="'MANY'" />
           
        </Block>
        


        <Block name="TSAW" comment="TpcSectorAndWheel"  >
<!--            <Medium name="STANDARD" deemax="0.248853" stmin="1.15055" /> -->
            <Medium name="STANDARD" />
            <Attribute for="TSAW" seen="1" colo="kYellow"  />
            <Shape type="PCON" zi="{204,TPCG_DzEnvelop-TPCG_MembTHK/2}" rmn="{48,48}" rmx="{208,208}" nz="2" phi1="-15" dphi="30"  />

            dX2 = 1.470
            dX  = 0

            <Use struct="TECW" select="sec" value="1"  />

            <Do var="inOut" from="kInner" to="kOuter"  >

mycount = 0;

                <Use struct="COOL" select="inout" value="inOut "  />
                <Use struct="RIBS" select="inout" value="inOut "  />
                <Use struct="HOLZ" select="inout" value="InOut "  />
                <Use struct="TECW" select="sec"   value="(inOut+1) "  />

                z2 = zWheel1
                z1 = z2 - TECW_Thick
                z  = (z1 + TPCG_MembTHK/2)/2
                dz = (z1 - TPCG_MembTHK/2)/2

                x1 = -TECW_Height/2
                x2 =  TECW_Height/2
                y1 =  TECW_inwidth/2
                y2 =  TECW_ouwidth/2
                x0 =  (y1*x2-y2*x1)/(x2-x1)

                dYdX  =  (y2 - y1)/(x2 - x1)
                alpha = 180./Pi*ATAN(dYdX)

                r1 = y1/dYdX
                r2 = y2/dYdX

                dRSectorShift = TECW_rMin - r1


<!-- Check that the code below doesn't have an indexing problem -->

                <If expr="inOut==kInner"  >
                    xHoles(0) = r2 - 1.988*INCH

                    <Do var="i" from="1" to="HOLZ_numberOfRows-1"  >
                        xHoles(i) = xHoles(i-1) - 1.575*INCH
                    </Do>
                    
                <Else  >

                    <Do var="i" from="0" to="HOLZ_numberOfRows - 1"  >
                        xHoles(i) = r2 - (1.988 + 1.575*i)*INCH 
                    </Do>
                        
                </Else>                    
                </If>
                

                <Create    block="TSAS"  />
                <Placement block="TSAS" konly="'MANY'" z="tsas_zoffset" />

                <Create    block="TWAS"  />
                <Placement block="TWAS"  konly="'MANY'" />

<If expr="inOut==0">                          <!-- Placed only once by AgSTAR rules -->
                <Create    block="TBRW"  />
                <Placement block="TBRW" x="TPCG_WheelR1" z="zWheel1+TPCG_WheelTHK/2" />
</If>
       

                x1 = TPCG_WheelR0*cos15
                x2 = TPCG_WheelR2
                dz = TPCG_WheelRibHeight/2
                z  = zWheel1 + dz
                dx = (x2 - x1)/2
                dy = TPCG_WheelTotalRibWidth/4
                x  = (x1 + x2)/2
                y  = (x *tan15 - dy)*(2*inOut-1)

                myDx=dy; myDy=dx; myDz=dz; myAlph=-(1-2*inOut)*15

                <Create    block="TWRB"  />
                <Placement block="TWRB"		    y="y" x="x" z="z" >
                    <Rotation ort="YX-Z"  />
                </Placement>
                

                dz = TPCG_WheelTHK/2
                z  = zWheel1 + dz
                dy = TPCG_WheelRibWidth/4
                x  = (x1 + x2)/2
                y  = (x *tan15 - dy)*(2*inOut-1)

                myDx=dy; myDy=dx; myDz=dz; myAlph=-(1-2*inOut)*15

                <Create    block="TWRB"  />
                <Placement block="TWRB" y="y" x="x" z="z" >
                    <Rotation ort="YX-Z"  />
                </Placement>



            </Do><!-- Loop on inOut -->
            


            <Do var="alpha" from="-15" to="15" step="30"  >

                <Do var="j" from="0" to="3"  >

                    <If expr="(j==0)"  >
                        r = TPCG_WheelR2 - 1.5/8.5*(TPCG_WheelR2 - TPCG_WheelR1)
                    </If>
                    
                    <If expr="(j==1)"  >
                        r = TPCG_WheelR2 - 6.5/8.5*(TPCG_WheelR2 - TPCG_WheelR1)
                    </If>
                    
                    <If expr="(j==2)"  >
                        r = TPCG_WheelR1 - 2.0/8.5*(TPCG_WheelR1 - TPCG_WheelR0)
                    </If>
                    
                    <If expr="(j==3)"  >
                        r = TPCG_WheelR1 - 7.0/8.5*(TPCG_WheelR1 - TPCG_WheelR0)
                    </If>
                    
                    x = r 
                    y = r *tand(alpha)
<!--
                    <Placement y="y" x="x" z="zWheel1+TPCG_WheelTHK/2" konly="'MANY'" block="TBRW"  >

                     AgSTAR does not place the first version of this at the same position -->

                    <Placement block="TBRW" y="y" x="x" z="zWheel1+TPCG_WheelTHK/2"><Rotation alphaz="alpha"/></Placement>

		    mycount+=1;
                    

                </Do>
                

                qwe(1) = -qwe(1)
                qwe(2) = -qwe(2)

            </Do>
            

            <Create    block="TWBT"  />
            <Placement block="TWBT" />
            
            <Create    block="TWRI"  />
	    <Placement block="TWRI" konly="'MANY'"  /> <!-- MANY volume because it is an assembly -->
            
            <Create    block="TWTR"  />
            <Placement block="TWTR"  />
            
            <Create    block="TWMR"  />
            <Placement block="TWMR"  />
            
            <Create    block="TRDO"  />
            <Placement block="TRDO" konly="'MANY'" />

            


            RCoolingTube = TPCG_WheelR2 - TPCG_heigTube - 2*TPCG_dxRDO
            <!--
            Bug in TPC geo?  Loop is from 0 to 7 inclusive but drdocooling is
            only dimensioned 0 to 6
            -->
            <Do var="iCoo" from="0" to="7"  >

                dz = TPCG_heigTube*cm/2
                dy = TPCG_widTube *cm/2
                z  = RCoolingTube
                dx1 = (z-dz)*tan15 - 2*TPCG_RDOCoolingdY
                dx2 = (z+dz)*tan15 - 2*TPCG_RDOCoolingdY

                <!--
                mySha='TRD1'
                myPar = {dx1,dx2,dy,dz}
                <Assign var="mySha" value="'TRD1'" />
                -->

		iShape = kTrd1; <Assign var="myPar" value="{dx1,dx2,dy,dz}" />
                
                <Create block="TCOO"  />
                <Placement x="z" z="(TPCG_zRDO-2*dy)" block="TCOO"  >
                    <Rotation ort="YZX"  />
                </Placement>
                
                RCoolingTube -= dRDOCooling(iCoo)

            </Do>
            

            dz = 4.5
            dy = 4.5/2
            z  = TPCG_zRDO + TPCG_dzRDO + dz
            x1 = TPCG_WheelR0
            x2 = TPCG_WheelR2
            dx = (x2 - x1)/2
            x  = (x1 + x2)/2
            <Do var="iCab" from="0" to="1"  >

                y  = - (x *tan15 - dy) * (1 - 2*iCab)
            <!--myPar={dy, dx, dz,-15*(1 - 2*iCab), 0, 0}-->
            	<Assign var="myPar" value="{dy, dx, dz, -15*(1-2*iCab), 0, 0}" />
                <Create block="TCAB"  />
                <Placement y="y" x="x" z="z" block="TCAB"  >
                    <Rotation ort="YX-Z"  />
                </Placement>
                

            </Do>
            

        </Block>
        


        <Block name="TSAS" comment="TpcInnerSectorAssembly &amp; TpcOuterSectorAssembly TSAS and TSA1"  >

<!--      	<Medium name="TSAS_STANDARD" deemax="0.248853" stmin="1.15055" /> -->
        
            <Shape type="PGON" zi="{zzzSA(1),zzzSA(2)}" 
	            	rmn="{rmnSA(inOut),rmnSA(inOut)}" 
	            	rmx="{rmxSA(inOut),rmxSA(inOut)}" 
	            	nz="2" npdiv="1" 
		        phi1="-15" dphi="30"  />


            <Attribute for="TSAS" seen="0"  />

            <Create block="TALS"/><Placement block="TALS"/>            
            <Create block="TSGT"/><Placement block="TSGT" z="tsgt_zoffset" />


            dy = (r2 - r1)/2
            y  = (r2 + r1)/2
            dx = TECW_widthRib/2
            dz = (TECW_Thick - TPCG_PadPlaneThickness - TECW_ThickAl)/2
            z  = z2 - dz
            dxW = TPCG_WireMountWidth/cos15/2
            dzW = TPCG_WireMountHeight/2
            xW = 0

            <Do var="iRib" from="0" to="1"  >
	      <!--
                mySha = 'PARA'
		myPar = {dx, dy, dz, -(1-2*iRib)*alpha}
		<Assign var="mySha" value="'PARA'" />
	      -->

	      iShape = kPara;  <Assign var="myPar" value="{dx, dy, dz, -(1-2*iRib)*alpha}" /> 
	      <Create block="TRIB"  />

	      x  = ((y1 + y2)/2 - dx)*(1-2*iRib)
	      <Placement block="TRIB" y="-x" x="y" z="z">
		<Rotation ort="YX-Z"  />
	      </Placement>
                

                xW = ((y1 + y2)/2 -  dxW)*(1-2*iRib)
				<!--
                myPar = {dxW, dy, dzW, -(1-2*iRib)*alpha, 0, 0}
                -->
                <Assign var="myPar" value="{dxW, dy, dzW, -(1-2*iRib)*alpha, 0, 0}" />
                <Create block="TWIR"  />
                zW = z1 - dzW/2

                <Placement y="-xW" x="y" z="zW" block="TWIR"  >
                    <Rotation ort="YX-Z"  />
                </Placement>
                

            </Do>
            

            <Do var="iRib" from="0" to="TECW_noribs-1"  >

                r   = r2 - RIBS_x(irib+1) * INCH 
                y   =      RIBS_y(irib+1) * INCH 
                dr  =      RIBS_dx(irib+1) * INCH 
                dy  =      RIBS_dy(irib+1) * INCH 

                <If expr="dy&lt;1.e-7"  >

                    dx2 =  r      *dYdX - TECW_widthRib - 2*dxW; ! TECW_widthLip
                    dx1 = (r - dr)*dYdX - TECW_widthRib - 2*dxW; ! TECW_widthLip
                    xc = r - TECW_zStepRib/2
					<!--
                    mySha='TRD1'
                    myPar = {dx1, dx2, dz, dr/2}
				
		<Assign var="mySha" value="'TRD1'" />
					-->
		iShape = kTrd1;
		<Assign var="myPar" value="{dx1, dx2, dz, dr/2}" />
					
                    <Create block="TRIB"  />
                    <Placement y="0" x="r-dr/2" z="z2-dz" block="TRIB"  >
                        <Rotation ort="YZX"  />
                    </Placement>
                    

                    <Else  >

			<!--
                        mySha='BOX '
                        myPar = {dr/2, dy/2, dz}
                        -->
<!--                      <Assign var="mySha" value="'BBOX'" /> -->
		      iShape = kBbox; <Assign var="myPar" value="{dr/2, dy/2, dz}" />

                        <Create    block="TRIB"  />
                        <Placement block="TRIB" y="y" x="r" z="z2-dz" />

                        

                    </Else>
                    
                </If>
                

            </Do>
            

        </Block>
        


        <Block name="TWAS" comment="TpcWheelInnerAssembly &amp; TpcWheelOuterAssembly TWAS and TWA1"  >

<!--	  <Medium name="TWAS_STANDARD" deemax="0.248853" stmin="1.15055" /> -->

          <Attribute for="TWAS" seen="0"  />
	  <Shape type="PGON" zi="{zzzWA(1),zzzWA(2)}" rmn="{rmnWA(inOut),rmnWA(inOut)}" rmx="{rmxWA(inOut),rmxWA(inOut)}" nz="2" npdiv="1" phi1="-15" dphi="30"  />

            dx =   TPCG_widTube*cm/2
            dz =   depthIOF(inOut+1)/2
            dy =   heightIOF(inOut+1)/2

            y1 = - dy
            y2 =   dy
            x1 =  width1IOF(inOut+1)/2 - dx
            x2 =  width2IOF(inOut+1)/2 - dx
            x0 =  (y1*x2-y2*x1)/(y2-y1)

            dYdX  =  (x2 - x1)/(y2 - y1)
            beta = 180./Pi*ATAN(dYdX)

            <If expr="(inOut==kOuter)"  >
                dy -= 0.7
            </If>
            
            y  = xHoles(0) - dy
            x = (x1 + x2)/2
            <Do var="iCoo" from="0" to="1"  >

	<Assign var="myPar" value="{dx, dy, dz,-(1-2*iCoo)*beta, 0, 0}" />
<!--	<Assign var="mySha" value="'PARA'" /> -->
iShape = kPara;
				<!--
                myPar={dx, dy, dz,-(1-2*iCoo)*beta, 0, 0}
                mySha = 'PARA'
                -->
                <Create block="TCOO"  />
                <Placement y="x*(2*iCoo-1)" x="y" z="zWheel1+dz" block="TCOO"  >
                    <Rotation ort="YX-Z"  />
                </Placement>
                

            </Do>
            

            <Do var="icoo" from="0" to="HOLZ_numberOfRows - 1"  >

                x = xHoles(iCoo);         !// cm 

                dx = TPCG_heigTube*cm/2
                dz = TPCG_widTube*cm/2
                dy = COOL_tubeLength( icoo+1 )*INCH / 2 

                <If expr="inOut==kInner"  >
                    dy2 = dy + 2*dYdX*dx
                    dy1 = dy;                  
                    <Else  >
                        dy2 = dy  
                        dy1 = dy - 2*dYdX*dx 
                    </Else>
                    
                </If>
                
				<!--
                mySha='TRD1'
                myPar= {dy1, dy2, dz, dx}
                -->
<!--              <Assign var="mySha" value="'TRD1'" /> -->
iShape = kTrd1;
              <Assign var="myPar" value="{dy1, dy2, dz, dx}" />               
                myPar(11) = x-dx-TFEE_AssemblyThickness/2+dRSectorShift
                myPar(13) = zWheel1+dz
                <Create block="TCOO"  />
                <Placement x="myPar(11)" z="myPar(13)" block="TCOO"  >
                    <Rotation ort="YZX"  />
                </Placement>
                


                <Do var="jcoo" from="0" to="HOLZ_numberPerRow(icoo+1) - 1"  >

                    y = HOLZ_yholes( 9*icoo + jcoo + 1 )*INCH

                    <Create block="FEEA"  />
                    <Placement y="y" x="x+TFEE_AssemblyThickness/2+dRSectorShift" z="zWheel1+2*dz+TFEE_RibDZ" konly="'MANY'" block="FEEA"  >
                    </Placement>
                    

                </Do>
                

            </Do>
            

        </Block>
        


        <Block name="FEEA" comment="TGeoVolumeAssembly(FEE)"  >

<!--
	  <Medium name  = "FEEA_STD" 
		  deemax= "0.248853" 
		  stmin = "1.15055" 
		  />
  -->

	  <Attribute for="FEEA" 
		     seen="1" 
		     colo="kGreen"  
		     />
	  
	  <Shape type="bbox"
		 dx="TFEE_ass(1)"
		 dy="TFEE_ass(2)"
		 dz="TFEE_ass(3)"
		 />
	  
	  <Attribute for="FEEA" 
		     seen="1" 
		     colo="42" 
		     />
	  
	  <!--
	      <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
	      %ivolume,%volume
	      </Print>
	  -->
	  
	  <Create block="FEEP"  />  <Placement block="FEEP"  />	 
	  <Create block="FEER"  />  <Placement block="FEER" x="-TFEE_RibDX-TFEE_CardDX" />	  
	  <Create block="FEEI"  />  <Placement block="FEEI" x="2*TFEE_CardDX" z="0.5" />
	  
	</Block>
        


        <Block name="FEEP" comment="FEEplate"  >
            <Attribute for="FEEP" seen="1" colo="kRed"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="FEEP_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="bbox"       dz="TFEE_PlateDZ" dx="TFEE_PlateDX" dy="TFEE_PlateDY"  />
        </Block>
        


        <Block name="FEER" comment="FEERib"  >
            <Attribute for="FEER" seen="1" colo="1"  />
            <Material name="ALUMINIUM"  />
<!--        <Medium name="FEER_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="bbox" dz="TFEE_RibDZ" dx="TFEE_RibDX" dy="TFEE_RibDY"  />
        </Block>
        


        <Block name="FEEI" comment="FEEitself"  >
            <Attribute for="FEEI" seen="1" colo="kViolet"  />
            <Material name="G10"  />
<!--        <Medium name="FEEI_g10" deemax="0.20313" stmin="0.0333806" /> -->
            <Shape type="bbox" dz="TFEE_CardDZ" dx="TFEE_CardDX" dy="TFEE_CardDY"  />
        </Block>
        


        <Block name="TALS" comment="TpcSectorAlSupport the Sector G10 alliminium support"  >

            <Attribute for="TALS" seen="1" colo="kYellow"  />
            <Material name="ALUMINIUM"  />
<!--        <Medium name="TALS_aluminium"  deemax="0.18296" stmin="0.0334422" /> -->            
            <Shape type="PGON" zi="{z1+TPCG_PadPlaneThickness,z1+TPCG_PadPlaneThickness+TECW_ThickAl}" rmn="{r1,r1}" rmx="{r2,r2}" nz="2" npdiv="1" phi1="-alpha" dphi="2*alpha"  />

            myPar(1)  = TECW_holeDx
            myPar(2)  = TECW_holeDy
            myPar(3)  = TECW_ThickAl/2

            myPar(13) = zWheel1 - TECW_Thick + TPCG_PadPlaneThickness + TECW_ThickAl/2


            <Do var="iTALS" from="0" to="HOLZ_numberOfRows - 1"  >
            myPar(11) = xHoles(iTALS); !// cm 
            <Do var="jtals" from="0" to="HOLZ_numberPerRow( itals+1 ) - 1"  >
            myPar(12) = HOLZ_yholes( 9*itals+jtals+1) *INCH 

            <Create block="THOL"  />
            <Placement block="THOL" y="myPar(12)" x="myPar(11)" z="myPar(13)" />
            </Do>                
            </Do>
            

        </Block>
        


        <Block name="TSGT" comment="TpcSectorG10 the Sector G10"  >

            <Attribute for="TSGT" seen="1" colo="kBlue"  />
            <Material name="G10"  />
<!--            <Medium name="TSGT_G10" deemax="0.20313" stmin="0.0333806" /> -->
            <Shape type="PGON" zi="{z1,z1+TPCG_PadPlaneThickness}" 
                   rmn="{r1,r1}" rmx="{r2,r2}" 
                   nz="2" npdiv="1" 
                   phi1="-alpha" dphi="2*alpha"  />

<!-- There is some odd behavior when it comes to ROOT/TGeo initializaing the deemax and
     stmin... some inconsistency with geant and/or starsim.  We therefore introduce the
     medium parameters by hand. -->

        </Block>
        


        <Block name="TWBT" comment="//WheelBottom"  >

            <Attribute for="TWBT" seen="1" colo="kGreen"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWBT_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="PCON" zi="{zWheel1,zWheel1+3.500*INCH,zWheel1+3.500*INCH,TPCG_LengthW/2}" rmn="{TPCG_WheelIR,TPCG_WheelIR,TPCG_WheelIR+3.6,TPCG_WheelIR+3.6}" rmx="{TPCG_WheelR0,TPCG_WheelR0,TPCG_WheelR0,TPCG_WheelR0}" nz="4" phi1="-15" dphi="30"  />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->


        </Block>
        

        <Block name="TWRI" comment="WheelOuterRing"  >


<!--            <Medium name="TWRI_standard" stmin="1.15055" /> -->
            <Shape type="PCON" zi="{zWheel1,zTOFCend,zTOFCend,TPCG_LengthW/2}" rmn="{TPCG_WheelR2*cos15,TPCG_WheelR2*cos15,TPCG_WheelR2*cos15,TPCG_WheelR2*cos15}" rmx="{TPCG_WheelOR1,TPCG_WheelOR1,TPCG_WheelOR,TPCG_WheelOR}" nz="4" phi1="-15" dphi="30"  />
			<Medium name="TWRI_something" deemax="0.248853" stmin="1.15055" />
            <Attribute for="TWRI" seen="0" colo="kGreen"  />
			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

            <Create    block="TWRC"  />
            <Placement block="TWRC"  />
            

            myCos = cos15; myRmin=TPCG_WheelR2; myRmax = TPCG_WheelOR1
            myG1 = myRmin*cos15

            nCount = 0

            <While expr="myg2 &lt; myRmin "  >

                ncount += 1
                myg2 = myRmin 

                <If expr="(myg2&gt;myRMax*myCos)"  >
                    myG2 = myRMax*myCos 
                </If>
                
 <!--
                alpha = ACOS(myCos)/Pi*180 
   -->
                alpha = ACos(myCos)*raddeg;

                <Create block="TWRG"  />
                <Placement block="TWRG"  />
                
                myCos = myG2/myRmin; myG1=myG2

                <If expr="(nCount&gt;10)"  >
                    break
                </If>
                
            </While>
            


        </Block>
        


        <Block name="TWRG" comment="WheelOuterRing PGON part"  >
            <Attribute for="TWRG" seen="1" colo="kGreen"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWRG_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="PGON" zi="{zWheel1,TPCG_LengthW/2}" rmn="{myG1,myG1}" rmx="{myG2,myG2}" nz="2" npdiv="1" phi1="-alpha" dphi="alpha*2"  />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TWRC" comment="WheelOuterRing PCON part"  >
            <Attribute for="TWRC" seen="1" colo="kGreen"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWRC_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="PCON" zi="{zWheel1,zTOFCend,zTOFCend,TPCG_LengthW/2}" rmn="{TPCG_WheelR2/cos15,TPCG_WheelR2/cos15,TPCG_WheelR2/cos15,TPCG_WheelR2/cos15}" rmx="{TPCG_WheelOR1,TPCG_WheelOR1,TPCG_WheelOR,TPCG_WheelOR}" nz="4" phi1="-15" dphi="30"  />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TWTR" comment="TpcWheelTopRib"  >

            <Attribute for="TWTR" seen="1" colo="kBlue"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWTR_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            myG1=TPCG_WheelR2 - (TPCG_WheelTotalRibWidth-TPCG_WheelRibWidth)/2
            <Shape type="PGON" zi="{zWheel1,zWheel1+TPCG_WheelRibHeight}" rmn="{myG1,myG1}" rmx="{TPCG_WheelR2,TPCG_WheelR2}" nz="2" npdiv="1" phi1="-15" dphi="30"  />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TWMR" comment="TpcWheelMiddleRib"  >

            <Attribute for="TWMR" seen="1" colo="kYellow"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWMR_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            myG1=TPCG_WheelR2 - (TPCG_WheelTotalRibWidth-TPCG_WheelRibWidth)/2
            <Shape type="PGON" nz="4" npdiv="1" phi1="-15" dphi="30" 
                   zi="{zWheel1,zWheel1+TPCG_WheelRibHeight,zWheel1+TPCG_WheelRibHeight,TPCG_LengthW/2}"  
            	   rmn="{ TPCG_WheelR1-TPCG_WheelTotalRibWidth/2,TPCG_WheelR1-TPCG_WheelTotalRibWidth/2,TPCG_WheelR1-TPCG_WheelRibWidth/2,TPCG_WheelR1-TPCG_WheelRibWidth/2}"
            	   rmx="{ TPCG_WheelR1+TPCG_WheelTotalRibWidth/2,TPCG_WheelR1+TPCG_WheelTotalRibWidth/2,TPCG_WheelR1+TPCG_WheelRibWidth/2,TPCG_WheelR1+TPCG_WheelRibWidth/2}" 
            />


			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TRDO" comment="TpcRDOAssembly"  >

            <Attribute for="TRDO" seen="0"  />
            <Attribute for="TRDO" seen="1" colo="kYellow"  />
<!--            <Medium name="TRDO_whatever" deemax="0.248853" stmin="1.15055" /> -->
            <Shape type="PGON" zi="{zzzRDO(1),zzzRDO(2)}" rmn="{rmnRDO(1),rmnRDO(2)}" rmx="{rmxRDO(1),rmxRDO(2)}"  nz="2" npdiv="1" phi1="-15" dphi="30"  />
            
			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->
            <!--
            mySha = 'PARA'
            myPar = {TPCG_RDOCoolingdY, TPCG_RDOCoolingdX, TPCG_RDOCoolingdZ, 15}
            -->
<!--            <Assign var="mySha" value="'PARA'" /> -->
iShape = kPara;
            <Assign var="myPar" value="{TPCG_RDOCoolingdY, TPCG_RDOCoolingdX, TPCG_RDOCoolingdZ, 15}" />
            x = TPCG_WheelR2 - TPCG_RDOCoolingdX
            y = x*tan15 - TPCG_RDOCoolingdY 
            z = TPCG_zRDO - 2*dy
            <Create block="TCOO"  />
            <Placement y="y" x="x" z="z" block="TCOO"  >
                <Rotation ort="YX-Z"  />
            </Placement>
            
			<!--
            mySha = 'PARA'
            myPar = {TPCG_RDOCoolingdY, TPCG_RDOCoolingdX, TPCG_RDOCoolingdZ, -15}
            -->
<!--            <Assign var="mySha" value="'PARA'" /> -->
iShape = kPara;
            <Assign var="myPar" value="{TPCG_RDOCoolingdY, TPCG_RDOCoolingdX, TPCG_RDOCoolingdZ, -15}" />
            
            x = TPCG_WheelR2 - TPCG_RDOCoolingdX
            y = x*tan15 - TPCG_RDOCoolingdY 
            z = TPCG_zRDO - 2*dy
            <Create block="TCOO"  />
            <Placement y="-y" x="x" z="z" block="TCOO"  >
                <Rotation ort="YX-Z"  />
            </Placement>
            



            RCoolingTube = TPCG_WheelR2 - TPCG_heigTube - 2*TPCG_dxRDO
            <!--
            Bug in TPC geo?  Loop is from 0 to 7 inclusive but drdocooling is
            only dimensioned 0 to 6
            -->
            <Do var="iCoo" from="0" to="7"  >

                dz = TPCG_heigTube*cm/2
                dy = TPCG_widTube*cm/2
                z  = RCoolingTube
                dx1 = (z-dz)*tan15 - 2*TPCG_RDOCoolingdY
                dx2 = (z+dz)*tan15 - 2*TPCG_RDOCoolingdY
				<!--
                mySha = 'TRD1'
                myPar = {dx1, dx2, dy, dz}
                -->
<!--                <Assign var="mySha" value="'TRD1'" /> -->
iShape = kTrd1;
                <Assign var="myPar" value="{dx1, dx2, dy, dz}" />
                myPar(11) = z; myPar(13) = TPCG_zRDO - 2*dy
                <Create block="TCOO"  />
                <Placement y="0" x="myPar(11)" z="myPar(13)" block="TCOO"  >
                    <Rotation ort="YZX"  />
                </Placement>
                


                <If expr="(iCoo .ne. 0 .and. iCoo .ne. 6)">

                    myPar(11) = z + dz + TPCG_dxRDO; 
                    myPar(13) =          TPCG_zRDO-TPCG_dzRDO

                    <Create block="TRDC"  />
                    <Placement y="0" x="myPar(11)" z="myPar(13)" block="TRDC"  />
                    

                </If>
                

                RCoolingTube -= dRDOCooling(iCoo)

            </Do>
            

        </Block>
        


        <Block name="TBRW" comment="WheelRibBox"  >
            <Attribute for="TBRW" seen="1" colo="kViolet"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TBRW_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="bbox" dz="TPCG_WheelTHK/2" dx="TPCG_WheelBoxDy/2" dy="TPCG_WheelBoxDx/2"  />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->
            

        </Block>
        


        <Block name="TWRB" comment="TpcWheelRib"  >
            <Attribute for="TWRB" seen="1" colo="kYellow"  />
            <Material name="ALUMINIUM"  />
<!--            <Medium name="TWRB_aluminium" deemax="0.18296" stmin="0.0334422" /> -->
            <Shape type="PARA" dz="myDz" alph="myAlph" dx="myDx" dy="myDy" thet="0" phi="0" />
			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TCOO" comment="CoolingTube"  >

	  <Attribute for="TCOO" seen="1" colo="kRed"  />
	  <Material name="Water_Pipe"  />
<!--	  <Medium name="TCOO_h2o_pipe" deemax="0.184746" stmin="0.0348298" /> -->


	  <If expr="iShape==kPara">
	    <Shape type="PARA" dz="myPar(3)" alph="myPar(4)" dx="myPar(1)" dy="myPar(2)" thet="0" phi="0"  />
	  </If>
            
	  <If expr="iShape==kTrd1" >
	    <Shape type="TRD1" dz="myPar(4)" dx2="myPar(2)" dx1="myPar(1)" dy="myPar(3)"  />
	  </If>
            
        </Block>
        


        <Block name="TCAB" comment="Cables"  >
            <Attribute for="TCAB" seen="1" colo="kGreen"  />
            <Material name="Cables"  />
<!--            <Medium name="TCAB_Cables" deemax="0.172513" stmin="0.0388322" /> -->
            <Shape type="PARA" dz="myPar(3)" alph="myPar(4)" dx="myPar(1)" dy="myPar(2)" thet="0" phi="0" />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        



        <Block name="TRDC" comment="RDOCard"  >
            <Attribute for="TRDC" seen="1" colo="kBlue"  />
            <Material name="G10"  />
<!--            <Medium name="TRDC_g10" deemax="0.20313" stmin="0.0333806" /> -->
            <Shape type="bbox" dz="TPCG_dzRDO" dx="TPCG_dxRDO" dy="TPCG_dyRDO" />

			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->

        </Block>
        


        <Block name="TRIB" comment="Tpc Ribs"  >

            <Attribute for="TRib" seen="1" colo="kRed"  />
            <Material name="ALUMINIUM"  />
<!--	    <Medium name="TRIB_aluminium" deemax="0.18296" stmin="0.0334422" /> -->

            <!-- <If expr="mySha=='PARA'"  > -->
            <!-- NOTE: Provided thet=phi=0 -->
	    <If expr="iShape==kPara">
                <Shape type="PARA" dz="myPar(3)" alph="myPar(4)" dx="myPar(1)" dy="myPar(2)" thet="0" phi="0" />
            <Elif expr="iShape==kTrd1">
                <Shape type="TRD1" dz="myPar(4)" dx2="myPar(2)" dx1="myPar(1)" dy="myPar(3)"  />
            <Elif expr="iShape==kBbox">
            <!-- NOTE: Switched to bbox from PARA -->
                <Shape type="BBOX" dz="myPar(3)" dx="myPar(1)" dy="myPar(2)"  />
            </Elif>
               
                    <!-- Else  >
                        <Print level="0" fmt="'============================= ERROR in TRIB: Unknown shape:',A4"  >
                            mySha
                        </Print>
                        
                        <Print level="0" fmt="'Creating volume ',I4,2X,A4"  >
                            %ivolume,%volume
                        </Print>
                        
                        <Print level="0" fmt="'+ moth=',I4,2X,A4"  >
                            %imother,%mother
                        </Print>
                        
                        <Print level="0" fmt="'+ imat=',I4,2X,A20"  >
                            %imat,%material
                        </Print>
                        
                        <Print level="0" fmt="'+ imed=',I4,2X,A20"  >
                            %imed,%medium
                        </Print>
                        
                        <Print level="0" fmt="'+ shape=',A4"  >
                            %shape
                        </Print>
                        
                        <Print level="0" fmt="'+ list=',A20"  >
                            %parlist
                        </Print>
                        
                    </Else -->
                
                    
                </Elif>
                
            </If>
            
			<!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->
            
        </Block>
        


        <Block name="TWIR" comment="WireMount"  >

            <Attribute for="TWIR" seen="1" colo="kYellow"  />
            <Material name="G10"  />
<!--                  <Medium name="TWIR_g10" deemax="0.20313" stmin="0.0333806" /> -->
            <Shape type="PARA" dz="myPar(3)" alph="myPar(4)" dx="myPar(1)" dy="myPar(2)" thet="0" phi="0" />
            <!--
            <Print level="1" fmt="'Creating volume ',I4,2X,A4"  >
                %ivolume,%volume
            </Print>
            -->
        </Block>
        


        <Block name="THOL" comment="the Sector holes for FEE"  >

            <Attribute for="THOL" seen="1" colo="kGreen"  />
            <Material name="Air"  />
<!--        <Medium name="THOL_Air" deemax="0.248853" stmin="1.15055" /> -->
            <Shape type="bbox" dz="myPar(3)" dx="myPar(1)" dy="myPar(2)"  />


            <Create block="FEES"/> <Placement block="FEES"  />

            

        </Block>
        


        <Block name="FEES" comment="TFEESocket"  >
            <Material name="G10"  />
<!--        <Medium name="FEES_g10" deemax="0.20313" stmin="0.0333806" /> -->
            <Attribute for="FEES" seen="1" colo="kBlue"  />
            <Shape type="bbox" dz="5.8/20" dx="6.2/20" dy="57./20"  />
        </Block>
        


        <Block name="TPGV" comment="is the Gas Volume placed in TPC"  >

            <Attribute for="TPGV" seen="1" colo="kRed"  />
            <Material name="P10"  />
<!--        <Medium name="TPGV_p10" deemax="0.248246" stmin="1.60594" /> -->
            <Shape type="TUBE" rmax="tpcg_SenGasOR" rmin="tpgvIR" dz="tpgvLeng/2" />

            <Do var="iSecAng" from="15" to="360-15" step="30"  >

                <Create    block="TPSS"  />
                <Placement block="TPSS"            konly="'MANY'"  >
                <!-- 
		     Place with copy number=1 for each instance of TPSS.
		     What is the reason for the "MANY" flag?

                     Well... ncopy=1 doesn't work here... Wonder what the problem is...
		-->
                           <Rotation alphaz="iSecAng"  />
                </Placement>
                
            </Do>
            
        </Block>
        


        <Block name="TPSS" comment="is a division of gas volume corresponding to a supersectors"  >

            <Attribute for="TPSS" seen="1" colo="kBlue"  />
<!--
            <Medium name="TPSS_whatever" deemax="0.248246" stmin="1.60594" />
  -->
            <Shape type="TUBS" phi2="15" phi1="-15"  />
            
<!--
            Here is a diference... copy number is reset for each TPSS
            ag_ncopy = 1 
-->
            <Do var="kase" from="1" to="2"  >
	      <Do var="i_sec" from="1" to="2"  >

		<Use struct="TPRS" select="sec" value="i_sec"  />
		<Use struct="TECW" select="sec" value="i_sec"  />

		zWheel1  = TPCG_LengthW/2 - TPCG_WheelTHK 
		zBeg     = TPCG_MembTHK/2 
		zEnd     = TPCG_zGroundGrid + TPRS_dAnode*2
		<If expr="i_sec==1"> zDed     = TPCG_zGatingGrid - TPCG_IDeadZone  </If>
		<If expr="i_sec==2"> zDed     = TPCG_zGatingGrid - TPCG_DeadZone </If>
		zPmt     = TPCG_zGatingGrid
		dx       = tprs_width/2

		<If expr="kase==1"  >
		  dz = (zDed - zBeg)/2; 
		  z  = (zDed + zBeg)/2 - tpgvz
		</If>
                    
		<If expr="kase==2"  >
		  dz = (zEnd - zPmt)/2; 
		  z  = (zEnd + zPmt)/2 - tpgvz
		</If>
                    

                    <Do var="i_row" from="1" to="NINT(tprs_nRow)"  >
                        <If expr="(NINT(tprs_super)==3|i_row==1)"  >
                            dy=tprs_npads(i_row)*tprs_pitch/2
                            x=tprs_Rpads(i_row)-tprs_width
                            <Create block="TPAD" /><Placement block="TPAD" x="x" z="z" dx="dx" dy="dy" dz="dz" />
                        </If>
                        
                        dy=tprs_npads(i_row)*tprs_pitch/2
                        x=tprs_Rpads(i_row)
                        <Create block="TPAD" /><Placement x="x" z="z" block="TPAD" dx="dx" dy="dy" dz="dz" />
                        
                        <If expr="(NINT(tprs_super)==3|i_row==NINT(tprs_nRow))"  >
                            x=tprs_Rpads(i_row)+tprs_width 
                            dy=tprs_npads(i_row)*tprs_pitch/2
                            <Create block="TPAD"/> <Placement x="x" z="z" block="TPAD" dx="dx" dy="dy" dz="dz" />                            
                        </If>
                        
                    </Do>
                    
                </Do>
                
            </Do>
            

        </Block>
        


        <Block name="TPAD" comment="is a REAL padrow WITH dimensions defined at positioning time"  >


            <Attribute for="TPAD" seen="1" colo="2" serial="1" cond="TPRS_width&lt;1.5" />
            <Attribute for="TPAD" seen="1" colo="2" serial="2" cond="TPRS_width&gt;1.5" />
<!--
  n.b. This is an explicit hack to get around the issue in the stacker where I
       cannot detect changes to the medium and create a new volume.  We invoke
       serialization instead.
  -->
            <Material name="p10"  />
            <Material isvol="1" stemax="2.5*tprs_width" name="sensitive_gas"  />
            <Medium name="TPAD_p10" isvol="1" stemax="2.5*tprs_width" deemax="0.00175367" stmin="0.0249056" />
            <Shape type="bbox" dz="0" dx="0" dy="0"  />
            
            <Cut name="CUTGAM" value="1e-4"  />
            <Cut name="CUTELE" value="1e-4"  />
            <Cut name="DCUTE" value="1e-4"  />
            <Cut name="DCUTM" value="1e-4"  />
            <Par name="STRA" value="1."  />


            <Instrument block="TPAD">

                 <!-- x,y,z coordinate.  S option always reats the hit as a single step -->
                 <Hit meas="z" bins="0.0005" opts="s" />
                 <Hit meas="y" bins="0.0005"          />
                 <Hit meas="x" bins="0.0005"          />

                 <!-- cosines of the angle in x, y, z with 10bit precision -->
                 <Hit meas="cx" nbits="10" />
                 <Hit meas="cy" nbits="10" />
                 <Hit meas="cz" nbits="10" />

                 <Hit meas="lptot" nbits="18"  min="-3" max="2" />
                 <Hit meas="sleng" bins="0.1"  min="0"  max="800" />
                 <Hit meas="tof"   nbits="16"  min="0"  max="TPCG_tofmax" />
                 <Hit meas="lgam"  nbits="16"  min="-2" max="+2" />
                 <Hit meas="step"  nbits="11"  min="0"  max="10" />
                 <Hit meas="user"  nbits="21"  min="-0.01" max="0.01" />

            </Instrument>            

        </Block>
        

    </Module>
    

</Document>

